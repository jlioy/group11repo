\documentclass[letterpaper, onecolumn, draftclsnofoot, 10pt, compsoc]{IEEEtran}

\usepackage{graphicx}                                        
\usepackage{amssymb}                                         
\usepackage{amsmath}                                         
\usepackage{amsthm}                                          
\usepackage{alltt}                                           
\usepackage{float}
\usepackage{color}
\usepackage{url}
\usepackage{balance}
\usepackage{enumitem}
\usepackage{pstricks, pst-node}
\usepackage{setspace}

\usepackage{geometry}
\geometry{textheight=9.5in, textwidth=7in}

\usepackage{listings}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
  backgroundcolor=\color{backcolour},  
  commentstyle=\color{codegreen},
  keywordstyle=\color{magenta},
  numberstyle=\tiny\color{codegray},
  stringstyle=\color{codepurple},
  basicstyle=\footnotesize,
  breakatwhitespace=false,         
  breaklines=true,                 
  captionpos=b,                    
  keepspaces=true,                 
  numbers=left,                    
  numbersep=5pt,                  
  showspaces=false,                
  showstringspaces=false,
  showtabs=false,                  
  tabsize=2
}

\lstset{style=mystyle}

\newcommand{\cred}[1]{{\color{red}#1}}
\newcommand{\cblue}[1]{{\color{blue}#1}}

\usepackage{hyperref}
\hypersetup{
    colorlinks=false,
    pdfborder={0 0 0},
}
\usepackage{geometry}

\def \name{Joshua Lioy}
\def \GroupNumber{11}
\def \GroupMemberOne{Joshua Lioy}
\def \GroupMemberTwo{Brian Wiltse}

\begin{document}
\begin{titlepage}
    \pagenumbering{gobble}
    \begin{singlespace}
    	\includegraphics[height=4cm]{coe_v_spot1}
        \hfill 
        \par\vspace{.2in}
        \centering
        \scshape{
            \huge Operating Systems 2 \par
            {\large\today}\par
            \vspace{.5in}
            \textbf{\Huge Homework 4: The SLOB SLAB}\par
            \vfill
            \vspace{5pt}
            {\large Prepared by }\par
            Group \GroupNumber\par
            \vspace{5pt}
            {\Large
                \GroupMemberOne\par
                \GroupMemberTwo\par
            }
            \vspace{20pt}
        }
        \begin{abstract}
        This document covers Group 11's details for implementing the best fit algorithm in the Linux SLOB SLAB.
        \end{abstract}     
    \end{singlespace}
\end{titlepage}

\newpage
\pagenumbering{arabic}
\tableofcontents

\newpage
\section{Design Plan}
    \begin{singlespace}
        Our goal for this assignment is to take the existing implementation of the SLOB. The existing implementation makes use of the first-fit algorithm which looks for the first page that has enough space and places the data in that location. Our new implementation will use the best-fit algorithm which will iterate through the list and store the smallest location that will still fit the chunk of memory.
        
        Late note: We planned to use testing for our system calls. Our original plan consisted of using system calls to return total amount of space allocated and total claimed space, but this was calculating total fragmentation rather than internal fragmentation. We had to change our plan significantly to complete the assignment.
    \end{singlespace}
    
\section{Version Control Log}
    \input{log.tex}
    
\section{Work Log}
    \begin{singlespace}
        \textbf{Monday 11/27}
            \begin{itemize}
                \item 10am - 11am, Brian 
                \begin{itemize}
                    \item Researched SLOB and first-fit and best-fit.
                \end{itemize}
            \end{itemize}
        \textbf{Tuesday 11/28}
            \begin{itemize}
                \item 10am-10:45am, Joshua and Brian 
                \begin{itemize}
                    \item Put together design plan
                    \item Split up work
                \end{itemize}
            \end{itemize}
        \textbf{Wednesday, 11/29}
            \begin{itemize}
                \item 9:30am-3:30pm, Brian
                \begin{itemize}
                    \item Office hours for (primarily) HW4 questions 
                    \item Wrote testing program
                    \item Tried to get syscalls to work
                \end{itemize}
                \item 10:00am - 1:00pm, Joshua
                \begin{itemize}
                    \item Worked on the implementation of best-fit algorithm.
                    \item Worked on write-up.
                \end{itemize}
            \end{itemize}
        \textbf{Thursday, 11/30}
            \begin{itemize}
                \item 10am-12pm, Joshua and Brian 
                \begin{itemize}
                    \item Continued working on best-fit algorithm 
                \end{itemize}
            \end{itemize}
        \textbf{Friday, 12/1}
            \begin{itemize}
                \item 9am-1:45pm, Joshua and Brian 
                \begin{itemize}
                    \item Office hours
                    \item Tried to get internal fragmentation figured out
                    \item finalized document
                    \item organized files for submission
                \end{itemize}
            \end{itemize}
    \end{singlespace}
        
\section{Questions}
    
    \subsection{What do you think the main point of this assignment is?}
        \begin{singlespace}
        We think the main point of the assignment is learning how to test kernel components. The best-fit algorithm attempts to optimize allocation of slab memory, but in practice it dramatically slows down memory allocation. It is important to know how to test any modifications to the kernel to ensure it behaves as expected.
         
        \end{singlespace}
    
    \subsection{How did you personally approach the problem? Design decisions, algorithm, etc.}
        \begin{singlespace}
        It seemed natural to split up the work such that one of us worked on testing the current implementation of the slob slab while the other worked on implementing the best-fit algorithm. We figured that once both components were complete, the test procedure for the current slob slab could be replicated for the best-fit algorithm.
        
        Our implementation of the best-fit algorithm consisted of creating a variable best\_fit to keep track of the current best-fit page that the iteration of the list has encountered. As we iterate through the list, if there is no page that is large enough to store the data, a new page will be allocated. Once we reach the end of the list, the smallest free space that will contain the memory is used.
        
        The test script simply takes an integer as seed for a pseudorandom number and allocates and deallocates enough space for a random number of chars multiple times. We calculate the amount of claimed space over the amount of allocated space. We obtained these data from system calls.
        
        The two system calls work as follows: One returns the amount of claimed space, which we track in the slob\_alloc and slob\_free functions. The other iterates through each list of (partially) free pages, and returns the amount of space between the beginning of the claimed memory and the end of the claimed memory. This value is our total. To calculate internal fragmentation, we divide claimed blocks from the first system call by the total returned from the latter system call.
        \end{singlespace}
    
    \subsection{How did you ensure your solution was correct? Testing details, for instance.}
        \begin{singlespace}
        We wrote a test script that allocates and deallocates random amount so memory, computing the fragmentation each time. Then we average the results.
        We expect less fragmentation in the best-fit algorithm, but it appears to be quite low in both cases. There is likely an error in our testing method.
        
        Below is the output for our best-fit algorithm:
        \begin{lstlisting}[language=bash]
root@qemux86:~/test_slab# ./test_slab 500
Fragmentation: 1.020227%
        \end{lstlisting}
        And for the first-fit algorithm:
        \begin{lstlisting}[language=bash]
root@qemux86:~/test_slab# ./test_slab 500
Fragmentation: 1.005267%
        \end{lstlisting}
        \end{singlespace}
    
    \subsection{What did you learn?}
        \begin{singlespace}
        We learned how the implementation of the first-fit algorithm works in the default configuration of the slob.c file as well as how to implement the best-fit algorithm. We also learned about creating custom system calls using both the asmlinakge and SYSCALL\_DEFINEN formats. We also learned how to use system calls to return values from the kernel to user space to test kernel components.
        \end{singlespace}
        
    \subsection{How should the TA test your patch?}
        \begin{singlespace}
        To test the patch use the following instructions (Note we are assuming that you have compiled the kernel and have booted into the virtual machine):
        
        One inside the VM please run the following command to create a c test file:
        \begin{lstlisting}[language=bash]
vi test_slob.c
        \end{lstlisting}
        
        Then please copy the contents of the test\_slob.c file that was included with our submission. Next please run the following command to compile the file:
        \begin{lstlisting}[language=bash]
        gcc -o test_slab test_slob.c
        \end{lstlisting}
        
        Next ensure that the compiled test\_slob.c file is executable and run the test program by entering a few values by running the following commands:
        \begin{lstlisting}[language=bash]
chmod +x test_slob
./test_slob <your number here>
        \end{lstlisting}
        
        Finally, to shutdown the kernel use the following command:
        \begin{lstlisting}[language=bash]
shutdown -h now
        \end{lstlisting}
        
        To run the test with the first-fit version of slob.c please rename the included slobff.c to slob.c and replace the existing best-fit version of the file. Then follow the previous steps to run the test again.

        \end{singlespace}
\end{document}
